kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: entando-crd-viewer
  labels:
    # Add these permissions to the "view" default role.
    rbac.authorization.k8s.io/aggregate-to-view: "true"
rules:
  - apiGroups:
      - apiextensions.k8s.io
    resources:
      - customresourcedefinitions
    resourceNames:
      - entandoapppluginlinks.entando.org
      - entandoapps.entando.org
      - entandodatabaseservices.entando.org
      - entandodebundles.entando.org
      - entandokeycloakservers.entando.org
      - entandoplugins.entando.org
      - providedcapabilities.entando.org
    verbs:
      - get

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: entando-crd-viewer
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: entando-crd-viewer
subjects:
  - kind: Group
    name: system:serviceaccounts

---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: entando-editor
  labels:
    # Add these permissions to the "edit" default role.
    rbac.authorization.k8s.io/aggregate-to-edit: "true"
rules:
  - apiGroups:
      - entando.org
    resources:
      - "*"
    verbs:
      - "*"

---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: entando-viewer
  labels:
    # Add these permissions to the "view" default role.
    rbac.authorization.k8s.io/aggregate-to-view: "true"
rules:
  - apiGroups:
      - entando.org
    resources:
      - "*"
    verbs:
      - "get"
      - "list"
      - "watch"

---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: entandoapppluginlinks.entando.org
  annotations:
    entando.org/controller-image: entando-k8s-app-plugin-link-controller
  labels:
    entando.org/crd-of-interest: EntandoAppPluginLink
spec:
  group: entando.org
  versions:
    - name: v1
      served: true
      storage: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Phase
          type: string
          jsonPath: .status.phase
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
        - name: App
          type: string
          jsonPath: .spec.entandoAppName
        - name: Plugin-NS
          type: string
          jsonPath: .spec.entandoPluginNamespace
        - name: Plugin-Name
          type: string
          jsonPath: .spec.entandoPluginName
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                entandoAppName:
                  description: >
                    The name (EntandoApp.metadata.name) of the EntandoApp that this EntandoAppPluginLink has to link to.
                  type: string
                entandoAppNamespace:
                  description: >
                    The Namespace (EntandoApp.metadata.namespace) of the EntandoApp that this EntandoAppPluginLink has to link to.
                    When this property is not specified, it is assumed that the targeted EntandoApp is in the same
                    Namespace as this EntandoAppPluginLink
                  type: string
                entandoPluginName:
                  description: >
                    The name (EntandoApp.metadata.name) of the EntandoPlugin that this EntandoAppPluginLink has to link to.
                  type: string
                entandoPluginNamespace:
                  description: >
                    The Namespace (EntandoApp.metadata.namespace) of the EntandoPlugin that this EntandoAppPluginLink has to link to.
                    When this property is not specified, it is assumed that the targeted EntandoPlugin is in the same
                    Namespace as this EntandoAppPluginLink
                  type: string
            status:
              type: object
              properties:
                observedGeneration:
                  type: number
                phase:
                  type: string
                entandoDeploymentPhase:
                  type: string
                serverStatuses:
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
  names:
    kind: EntandoAppPluginLink
    plural: entandoapppluginlinks
    shortNames:
      - elnk
  scope: Namespaced

---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: entandoapps.entando.org
  annotations:
    entando.org/controller-image: entando-k8s-app-controller
  labels:
    entando.org/crd-of-interest: EntandoApp
spec:
  group: entando.org
  versions:
    - name: v1
      served: true
      storage: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Phase
          type: string
          jsonPath: .status.phase
        - name: Observed Generation
          type: number
          jsonPath: .status.observedGeneration
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
        - name: Host
          type: string
          jsonPath: .spec.ingressHostName
        - name: Image
          type: string
          jsonPath: .spec.image
        - name: DBMS
          type: string
          jsonPath: .spec.dbms
        - name: Replicas
          type: integer
          jsonPath: .spec.replicas
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                replicas:
                  description: The number of pods that should participate in the cluster of this EntandoApp.
                  type: integer
                  minimum: 1
                  maximum: 10
                dbms:
                  description: >
                    The database management system (DBMS) to use for persistence of this EntandoApp. 
                    Can be any of mysql, oracle  postgresql, embedded or none. Only 1 replica of the container is supported if embedded is selected. If Oracle is selected it must be created manually, the operator does not deploy Oracle instances.

                    See [here] (https://dev.entando.org/v6.3/docs/concepts/operator-intro.html#database-deployment) for how the operator will create and configure the DBMS.
                  type: string
                  pattern: '^(mysql|oracle|postgresql|embedded|none)$'
                storageClass:
                  description: >
                    The name of the StorageClass to use for PersistentVolumeClaims created for this EntandoApp
                  type: string
                ingressHostName:
                  description: >
                    The hostname that will be used to access this EntandoApp from outside the cluster. The Entando
                    Operator will create an Ingress reflecting this hostname, and expose this EntandoApp on the
                    path specified in 'EntandoApp.spec.ingressPath' on
                    this host. If omitted, the Entando Operator will automatically generate a hostname.

                    See [here] (https://dev.entando.org/v6.3/docs/concepts/operator-intro.html#ingress-path-generation) for how the operator will create and configure the Ingress.
                  type: string
                  pattern: '^([A-Za-z0-9-]{1,63}\.)*[[A-Za-z0-9-]{1,63}$'
                ingressPath:
                  description: >
                    The path that will be used to expose this EntandoApp on the ingress host
                    specified in 'EntandoApp.spec.ingressHostname'. This property needs to be in sync with
                    the web context path that is used in the underlying WAR deployment. It should either be
                    the name of the WAR file that gets generated, or it needs to be in sync with the web context
                    specified in the jboss-web.xml deployment descriptor. The default value is 'entando-de-app'.
                  type: string
                tlsSecretName:
                  description: >
                    The name of a standard Kubernetes TLS Secret, assumed to be in the same Namespace as the EntandoApp being created.
                    See [here](https://dev.entando.org/v6.3/docs/concepts/operator-intro.html#tls-secret-creation) for details and instructions on
                    creating a secret for your Entando applications.
                  type: string
                  pattern: '^([a-z])+([a-z0-9-\.])*[a-z0-9]$'
                serviceAccountToUse:
                  description: >
                    The Kubernetes ServiceAccount in the Namespace of the EntandoApp that is to be used for
                    the Pods hosting the EntandoApps. The default is 'default'.
                  type: string
                  pattern: '^([a-z])+([a-z0-9-\.])*[a-z0-9]$'
                environmentVariables:
                  description: >
                    A list of environment variable following the standard structure of Kubernetes Environment Variables
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                      value:
                        type: string
                      valueFrom:
                        type: object
                        properties:
                          configMapKeyRef:
                            type: object
                            properties:
                              name:
                                description: Name of a ConfigMap in the same namespace as the EntandoApp
                                type: string
                              key:
                                description: Key of the ConfigMap entry in that holds the value to be used for the EnvironmentVariable
                                type: string
                          fieldRef:
                            type: object
                            properties:
                              apiVersion:
                                description: Version of the API to used for the field expression
                                type: string
                              fieldPath:
                                description: Full expression starting from the Pod resource
                                type: string
                          resourceFieldRef:
                            type: object
                            properties:
                              containerName:
                                description: Name of the container to use
                                type: string
                              resource:
                                description: Name of the resource to use
                                type: string
                          secretKeyRef:
                            type: object
                            properties:
                              name:
                                description: Name of a Secret in the same namespace as the EntandoApp
                                type: string
                              key:
                                description: Key of the Secret entry in that holds the value to be used for the EnvironmentVariable
                                type: string
                resourceRequirements:
                  description: >
                    The projected resource requirements of the given EntandoApp deployment. Specifies the limits that the
                    container is expected to respect, and the size of requests that will be initiated on behalf of the
                    container. When omitted our known defaults will be applied.
                  type: object
                  properties:
                    requests:
                      type: object
                      properties:
                        storage:
                          description: >
                            Size of persistent storage that will be requested when deployed. Can be omitted. Supported only
                            by a small subset of Kubernetes storage providers.
                          type: string
                        memory:
                          description: >
                            The amount of memory that will be requested when deployed. A pod will only be deployed to a node
                            that has this amount of memory available. You can  express memory as a plain integer using one of
                            these suffixes: T, G, M, K. You can also use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                          type: string
                        cpu:
                          description: >
                            The amount of CPU units that will be requested from a node at deployment time. A pod will only be
                            deployed to a node if the node has this amount of CPU units available. Supports decimal numbers, or
                            alternatively the suffix 'm' can be used to specify a millicore. Precision lower than 1m is not supported.
                          type: string
                    limits:
                      type: object
                      properties:
                        storage:
                          description: >
                            The maximum amount of persistent storage require by the EntandoApp. Mainly used
                            when the 'embedded' DBMS option is used. Limits and requests for memory are measured in bytes. You can
                            express storage as a plain integer using one of these suffixes: T, G, M, K. You can also
                            use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                          type: string
                        memory:
                          description: >
                            The maximum amount of memory that the container is expected to use. Kubernetes will limit the amount
                            of memory to the container the to amount specified. You can  express memory as a plain integer using one of
                            these suffixes: T, G, M, K. You can also use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                          type: string
                        cpu:
                          description: >
                            The maximum amount of CPU units that will be required by the container.Supports decimal numbers, or
                            alternatively the suffix 'm' can be used to specify a millicore. Precision lower than 1m is not supported.
                          type: string
                    storageRequest:
                      description: >
                        Size of persistent storage that will be requested when deployed. Can be omitted. Supported only
                        by a small subset of Kubernetes storage providers.
                      type: string
                    storageLimit:
                      description: >
                        The maximum amount of persistent storage require by the EntandoApp. Mainly used
                        when the 'embedded' DBMS option is used. Limits and requests for memory are measured in bytes. You can
                        express storage as a plain integer using one of these suffixes: T, G, M, K. You can also
                        use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                      type: string
                    memoryRequest:
                      description: >
                        The amount of memory that will be requested when deployed. A pod will only be deployed to a node
                        that has this amount of memory available. You can  express memory as a plain integer using one of
                        these suffixes: T, G, M, K. You can also use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                      type: string
                    memoryLimit:
                      description: >
                        The maximum amount of memory that the container is expected to use. Kubernetes will limit the amount
                        of memory to the container the to amount specified. You can  express memory as a plain integer using one of
                        these suffixes: T, G, M, K. You can also use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                      type: string
                    cpuRequest:
                      description: >
                        The amount of CPU units that will be requested from a node at deployment time. A pod will only be
                        deployed to a node if the node has this amount of CPU units available. Supports decimal numbers, or
                        alternatively the suffix 'm' can be used to specify a millicore. Precision lower than 1m is not supported.
                      type: string
                    cpuLimit:
                      description: >
                        The maximum amount of CPU units that will be required by the container.Supports decimal numbers, or
                        alternatively the suffix 'm' can be used to specify a millicore. Precision lower than 1m is not supported.
                      type: string
                    fileUploadLimit:
                      description: >
                        The maximum file upload size. This limit will be enforced by NGINX compliant Ingress controllers.
                        The suffix 'm' allows the limit to be specified in megabytes, eg. '120m'.
                      type: string
                keycloakToUse:
                  type: object
                  description: >
                    The properties of this object configure which Keycloak server this EntandoApp will be using,
                    and allows the user to override the default Realm and PublicClientID to use.
                  properties:
                    realm:
                      description: >
                        The realm that will be used to create the OIDC Client for this EntandoApp. If omitted, the
                        default realm will be 'Entando'. If another realm is specified, and it doesn't exist by
                        the time the EntandoApp is deployed, the realm will be created on demand.
                      type: string
                    publicClientId:
                      description: >
                        The Client ID for the Public client that will be created this EntandoApp.
                        Only required if this microservice should be accessible from outside the cluster. The
                        default is 'entando-web'.
                      type: string
                    name:
                      description: >
                        The name of the EntandoKeycloakServer to use as OIDC provider. If no name is provided, the
                        Entando Operator will then look for any EntandoKeycloakServer in the same Namespace as this
                        EntandoApp and use it as OIDC provider. If no EntandoKeycloakServer is found,
                        it will then use the (last) EntandoKeycloakServer that was marked as the cluster wide  default
                        using the property EntandoKeycloakServer.spec.isDefault.
                      type: string
                    namespace:
                      description: >
                        The Namespace of the EntandoKeycloakServer to use as OIDC provider. This value is only
                        evaluated if the 'spec.keycloakToUse.name' property has been set on this
                        EntandoApp.  If no Namespace is provided,
                        but a name was provided, the Entando Operator will then look for the
                        EntandoKeycloakServer with the name specified in the same Namespace as this
                        EntandoApp and use it as OIDC provider.
                      type: string
                standardServerImage:
                  description: >
                    Specifies the standard server base image that this EntandoApp has been packaged in. Valid values
                    are wildfly (https://github.com/entando/entando-docker-base-images/tree/master/entando-wildfly17-base)
                    or eap (https://github.com/entando/entando-docker-base-images/tree/master/entando-eap72-clustered-base).
                    This property is required to provide the appropriate environment variables to the deployed container.
                    This should be used in conjunction with the 'EntandoApp.spec.customServerImage' property to indicate
                    which base image the custom server image was based on. If no customer server image is specified, this
                    property will result in the deployment of the entando/entando-de-app-eap image for the value 'eap',
                    and the entando/entando-de-app-wildfly image for the value 'wildfly'.
                  type: string
                  pattern: '^(wildfly|eap)$'
                customServerImage:
                  description: >
                    The full Docker image URI for the Docker image to be deployed. This is only required in scenarios
                    where the user has created an independent Maven project based on the entando-de-app project
                    (https://github.com/entando-k8s/entando-de-app) and packaged this project to its own image.
                    Use this property in conjunction with 'EntandoApp.spec.standardServerImage' to ensure that the
                    Entando Operator provides it with the correct environment variables.
                  type: string
                componentRepositoryNamespaces:
                  description: >
                    A list of names of Namespaces in the cluster that are used as a store of Entando Bundles
                  type: array
                  items:
                    type: string
                    pattern: '^([a-z])+([a-z0-9-\.])*[a-z0-9]$'
                entandoAppVersion:
                  description: >
                    The version of the core EntandoApp component to deploy. Use a SemVer compliant version.
                  type: string
                ecrGitSshSecretName:
                  description: >
                    A standard Kubernetes Secret that contains an SSH private/public keypair to use to access the
                    Entando Bundles on the Git server they are hosted on.
                  type: string
                  pattern: '^([a-z])+([a-z0-9-\.])*[a-z0-9]$'
            status:
              type: object
              properties:
                observedGeneration:
                  type: number
                phase:
                  type: string
                entandoDeploymentPhase:
                  type: string
                serverStatuses:
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
  names:
    kind: EntandoApp
    plural: entandoapps
    shortNames:
      - enap
  scope: Namespaced

---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: entandodatabaseservices.entando.org
  annotations:
    entando.org/controller-image: entando-k8s-database-service-controller
    entando.org/supported-capabilities: mysql.dbms,oracle.dbms,postgresql.dbms,dbms
  labels:
    entando.org/crd-of-interest: EntandoDatabaseService
spec:
  group: entando.org
  versions:
    - name: v1
      served: true
      storage: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Phase
          type: string
          jsonPath: .status.phase
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
        - name: DBMS
          type: string
          jsonPath: .spec.dbms
        - name: Replicas
          type: integer
          jsonPath: .spec.replicas
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                replicas:
                  description: >-
                    The number of pods that should participate in the cluster of
                    Database servers. For advanced use cases only.
                  type: integer
                  minimum: 1
                  maximum: 10
                dbms:
                  description: >
                    The database management system (DBMS) to make available as a Kubernetes Service.
                    Can be oracle, mysql or postgresql. Only 1 replica of the container is supported if embedded is selected. If
                    Oracle is selected it must be created manually, the operator does not deploy Oracle instances.
                    See [here](https://dev.entando.org/v6.3/docs/concepts/operator-intro.html#database-deployment) for how the operator will create and configure the DBMS.
                  type: string
                  pattern: ^(mysql|oracle|postgresql)$
                storageClass:
                  description: >
                    The name of the StorageClass to use for PersistentVolumeClaims created for this EntandoDatabaseService
                  type: string
                provisioningStrategy:
                  description: >
                    The strategy that will be used to make this EntandoDatabaseService
                    available to its consumers. Values:

                    * UseExternal - use this EntandoDatabaseService resource to point to an existing external Database Service that
                    points to an external database service as specified in the 'host' and 'port' properties.

                    * DeployDirectly - deploy a new Database Service on demand
                  type: string
                  pattern: ^(UseExternal|DeployDirectly|DelegateToOperator)$
                createDeployment:
                  description: >
                    **DEPRECATED** - use provisioningStrategy instead. If no provisioningStrategy is specified, a
                    value of 'true' will be the equivalent of a provisioningStrategy of 'DeployDirectly'.
                  type: boolean
                host:
                  description: >
                    When 'spec.provisioningStrategy' is 'UseExternal', this field is required to
                    create a Service  that points to an external database server using
                    the value of the host property.
                  type: string
                  pattern: '^([A-Za-z0-9-]{1,63}\.)*[[A-Za-z0-9-]{1,63}$'
                port:
                  description: >
                    When 'spec.provisioningStrategy' is 'UseExternal', this field is required to
                    create a Service that points to an external database service running
                    on the port specified on this property. If no value is provided, it
                    defaults to the default port of the DBMS in question.
                  type: integer
                databaseName:
                  description: >
                    When connecting to an external database, this is the name of the database
                    that this database service will connect to. When deploying the DBMS directly
                    and PostgreSQL is being used, it will create the database
                    on PostgreSQL. This property has no effect on MySQL.
                  type: string
                tablespace:
                  description: >
                    Only used in Oracle to specify the tablespace that tables should be
                    created on.
                  type: string
                secretName:
                  description: >
                    The name of a Kubernetes Secret that contains the username and password
                    of a user on the database server that has superuser permissions.
                  type: string
                providedCapabilityScope:
                  description: >
                    The scope at which this EntandoDatabaseService will be made available to
                    possible consumers. Values are as follows:

                    *  Dedicated - only valid when specified from a consumer, and will be resolved using the suffix '-db'

                    *  Specified - not supported in any of our consumers yet.

                    *  Namespace - all requirements for a DBMS with matching implementations in the namespace will resolve to this instance

                    *  Cluster - all requirements for a DBMS with matching implementations in the cluster will resolve to this instance

                    *  Labeled - not supported in any of our consumers yet.
                  type: string
                  pattern: ^(Dedicated|Specified|Namespace|Cluster|Labeled)$
                jdbcParameters:
                  type: object
                  description: >
                    A map of name/value pairs that will be appended to the connection string
                    to the database in questions.
                  x-kubernetes-preserve-unknown-fields: true
                serviceAccountToUse:
                  description: >
                    The Kubernetes ServiceAccount in the Namespace of the
                    EntandoDatabaseService that is to be used for the Pods
                    hosting the database service. Can be left empty for most
                    situations, as the database container doesn't make direct use
                    of Kubernetes resources.
                  type: string
                  pattern: '^([a-z])+([a-z0-9-\.])*[a-z0-9]$'
                environmentVariables:
                  description: >
                    A list of environment variable following the standard
                    structure of Kubernetes Environment Variables
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                      value:
                        type: string
                      valueFrom:
                        type: object
                        properties:
                          configMapKeyRef:
                            type: object
                            properties:
                              name:
                                description: >-
                                  Name of a ConfigMap in the same namespace as
                                  the EntandoDatabaseService
                                type: string
                              key:
                                description: >-
                                  Key of the ConfigMap entry in that holds the
                                  value to be used for the EnvironmentVariable
                                type: string
                          fieldRef:
                            type: object
                            properties:
                              apiVersion:
                                description: >-
                                  Version of the API to used for the field
                                  expression
                                type: string
                              fieldPath:
                                description: Full expression starting from the Pod resource
                                type: string
                          resourceFieldRef:
                            type: object
                            properties:
                              containerName:
                                description: Name of the container to use
                                type: string
                              resource:
                                description: Name of the resource to use
                                type: string
                          secretKeyRef:
                            type: object
                            properties:
                              name:
                                description: >-
                                  Name of a Secret in the same namespace as the
                                  EntandoDatabaseService
                                type: string
                              key:
                                description: >-
                                  Key of the Secret entry in that holds the
                                  value to be used for the EnvironmentVariable
                                type: string
                resourceRequirements:
                  description: >
                    The projected resource requirements of the given database
                    deployment. Specifies the limits that the container is
                    expected to respect, and the size of requests that will be
                    initiated on behalf of the container. When omitted our known
                    defaults will be applied.
                  type: object
                  properties:
                    requests:
                      type: object
                      properties:
                        storage:
                          description: >
                            Size of persistent storage that will be requested when deployed. Can be omitted. Supported only
                            by a small subset of Kubernetes storage providers.
                          type: string
                        memory:
                          description: >
                            The amount of memory that will be requested when deployed. A pod will only be deployed to a node
                            that has this amount of memory available. You can  express memory as a plain integer using one of
                            these suffixes: T, G, M, K. You can also use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                          type: string
                        cpu:
                          description: >
                            The amount of CPU units that will be requested from a node at deployment time. A pod will only be
                            deployed to a node if the node has this amount of CPU units available. Supports decimal numbers, or
                            alternatively the suffix 'm' can be used to specify a millicore. Precision lower than 1m is not supported.
                          type: string
                    limits:
                      type: object
                      properties:
                        storage:
                          description: >
                            The maximum amount of persistent storage required by the
                            database server.  Limits and requests for memory are
                            measured in bytes. You can express storage as a plain
                            integer using one of these suffixes: T, G, M, K. You can
                            also use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                          type: string
                        memory:
                          description: >
                            The maximum amount of memory that the container is expected to use. Kubernetes will limit the amount
                            of memory to the container the to amount specified. You can  express memory as a plain integer using one of
                            these suffixes: T, G, M, K. You can also use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                          type: string
                        cpu:
                          description: >
                            The maximum amount of CPU units that will be required by the container.Supports decimal numbers, or
                            alternatively the suffix 'm' can be used to specify a millicore. Precision lower than 1m is not supported.
                          type: string
                    storageRequest:
                      description: >
                        Size of persistent storage that will be requested when
                        deployed. Can be omitted. Supported only by a small
                        subset of Kubernetes storage providers.
                      type: string
                    storageLimit:
                      description: >
                        The maximum amount of persistent storage required by the
                        database server.  Limits and requests for memory are
                        measured in bytes. You can express storage as a plain
                        integer using one of these suffixes: T, G, M, K. You can
                        also use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                      type: string
                    memoryRequest:
                      description: >
                        The amount of memory that will be requested when
                        deployed. A pod will only be deployed to a node that has
                        this amount of memory available. You can  express memory
                        as a plain integer using one of these suffixes: T, G, M,
                        K. You can also use the power-of-two equivalents: Ti,
                        Gi, Mi, Ki.
                      type: string
                    memoryLimit:
                      description: >
                        The maximum amount of memory that the container is
                        expected to use. Kubernetes will limit the amount of
                        memory to the container the to amount specified. You
                        can  express memory as a plain integer using one of
                        these suffixes: T, G, M, K. You can also use the
                        power-of-two equivalents: Ti, Gi, Mi, Ki.
                      type: string
                    cpuRequest:
                      description: >
                        The amount of CPU units that will be requested from a
                        node at deployment time. A pod will only be deployed to
                        a node if the node has this amount of CPU units
                        available. Supports decimal numbers, or alternatively
                        the suffix 'm' can be used to specify a millicore.
                        Precision lower than 1m is not supported.
                      type: string
                    cpuLimit:
                      description: >
                        The maximum amount of CPU units that will be required by
                        the container.Supports decimal numbers, or alternatively
                        the suffix 'm' can be used to specify a millicore.
                        Precision lower than 1m is not supported.
                      type: string
            status:
              type: object
              properties:
                observedGeneration:
                  type: number
                phase:
                  type: string
                serverStatuses:
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
  names:
    kind: EntandoDatabaseService
    plural: entandodatabaseservices
    shortNames:
      - eds
  scope: Namespaced

---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: entandodebundles.entando.org
  labels:
    entando.org/crd-of-interest: EntandoDeBundle
spec:
  group: entando.org
  scope: Namespaced
  names:
    kind: EntandoDeBundle
    plural: entandodebundles
  versions:
    - name: v1
      served: true
      storage: true
      subresources:
        status: {}
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              x-kubernetes-preserve-unknown-fields: true
              properties:
                details:
                  type: object
                  properties:
                    name:
                      type: string
                    description:
                      type: string
                    dist-tags:
                      x-kubernetes-preserve-unknown-fields: true
                      type: object
                    versions:
                      description: >
                        The available versions for this bundle.
                      type: array
                      items:
                        type: string
                    keywords:
                      description: >
                        Keywords to associate with this bundle in the Entando Component Repository.
                      type: array
                      items:
                        type: string
                    thumbnail:
                      description: >
                        A base-64 encoded string for an image to display with the bundle in the Entando Component Repository.
                      type: string
                      maxLength: 320000
                tags:
                  description: >
                    The tags that are available for this bundle in the git repository hosting the bundle contents.
                  type: array
                  items:
                    type: object
                    properties:
                      version:
                        type: string
                      integrity:
                        type: string
                      shasum:
                        type: string
                      tarball:
                        type: string
            status:
              type: object
              properties:
                observedGeneration:
                  type: number
                phase:
                  type: string
                serverStatuses:
                  type: object
                  x-kubernetes-preserve-unknown-fields: true

---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: entandokeycloakservers.entando.org
  annotations:
    entando.org/controller-image: entando-k8s-keycloak-controller
    entando.org/supported-capabilities: keycloak.sso,redhat_sso.sso,sso
  labels:
    entando.org/crd-of-interest: EntandoKeycloakServer
spec:
  group: entando.org
  versions:
    - name: v1
      served: true
      storage: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Phase
          type: string
          jsonPath: .status.phase
        - name: Observed Generation
          type: number
          jsonPath: .status.observedGeneration
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
        - name: Host
          type: string
          jsonPath: .spec.ingressHostName
        - name: Image
          type: string
          jsonPath: .spec.standardImage
        - name: DBMS
          type: string
          jsonPath: .spec.dbms
        - name: Replicas
          type: integer
          jsonPath: .spec.replicas
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                replicas:
                  description: >-
                    The number of pods that should participate in the cluster of
                    Keycloak servers.
                  type: integer
                  minimum: 1
                  maximum: 10
                dbms:
                  description: >
                    The database management system (DBMS) to use for persistence
                    of this Keycloak server. Can be any of mysql, oracle
                    postgresql or embedded.

                     Only 1 replica of the container is supported if embedded is selected. If
                     Oracle is selected it must be created manually, the operator does not deploy Oracle instances.
                     See [here](https://dev.entando.org/v6.3/docs/concepts/operator-intro.html#database-deployment) for how the operator will create and configure the DBMS.
                  type: string
                  pattern: ^(mysql|oracle|postgresql|embedded|none)$
                storageClass:
                  description: >
                    The name of the StorageClass to use for PersistentVolumeClaims created for this EntandoKeycloakServer
                  type: string
                ingressHostName:
                  description: >
                    The hostname that will be used to access this Keycloak
                    service from outside the cluster. The Entando Operator will
                    create an ingress reflecting this hostname, and expose
                    Keycloak on the '/auth' path on this host. If omitted, the operator will generate a default host
                    path.

                    See [here] (https://dev.entando.org/v6.3/docs/concepts/operator-intro.html#ingress-path-generation) for how the operator will create and configure the Ingress.

                  type: string
                  pattern: '^([A-Za-z0-9-]{1,63}\.)*[[A-Za-z0-9-]{1,63}$'
                tlsSecretName:
                  description: >
                    The name of a standard Kubernetes TLS Secret, assumed to be
                    in the same Namespace as the EntandoKeycloakServer being
                    created. See (here) [https://dev.entando.org/v6.3/docs/concepts/operator-intro.html#tls-secret-creation] for details and instructions on
                    creating a secret for your Entando applications.

                  type: string
                  pattern: '^([a-z])+([a-z0-9-\.])*[a-z0-9]$'
                serviceAccountToUse:
                  description: >
                    The Kubernetes ServiceAccount in the Namespace of the
                    EntandoKeycloakServer that is to be used for the Pods
                    hosting the Keycloak services. Can be left empty for most
                    situations, as the Keycloak service doesn't make direct use
                    of Kubernetes resources.
                  type: string
                  pattern: '^([a-z])+([a-z0-9-\.])*[a-z0-9]$'
                environmentVariables:
                  description: >
                    A list of environment variable following the standard
                    structure of Kubernetes Environment Variables
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                      value:
                        type: string
                      valueFrom:
                        type: object
                        properties:
                          configMapKeyRef:
                            type: object
                            properties:
                              name:
                                description: >-
                                  Name of a ConfigMap in the same namespace as
                                  the EntandoKeycloakServer
                                type: string
                              key:
                                description: >-
                                  Key of the ConfigMap entry in that holds the
                                  value to be used for the EnvironmentVariable
                                type: string
                          fieldRef:
                            type: object
                            properties:
                              apiVersion:
                                description: >-
                                  Version of the API to used for the field
                                  expression
                                type: string
                              fieldPath:
                                description: Full expression starting from the Pod resource
                                type: string
                          resourceFieldRef:
                            type: object
                            properties:
                              containerName:
                                description: Name of the container to use
                                type: string
                              resource:
                                description: Name of the resource to use
                                type: string
                          secretKeyRef:
                            type: object
                            properties:
                              name:
                                description: >-
                                  Name of a Secret in the same namespace as the
                                  EntandoKeycloakServer
                                type: string
                              key:
                                description: >-
                                  Key of the Secret entry in that holds the
                                  value to be used for the EnvironmentVariable
                                type: string
                resourceRequirements:
                  description: >
                    The projected resource requirements of the given Keycloak
                    deployment. Specifies the limits that the container is
                    expected to respect, and the size of requests that will be
                    initiated on behalf of the container. When omitted
                    defaults will be applied.
                  type: object
                  properties:
                    requests:
                      type: object
                      properties:
                        storage:
                          description: >
                            Size of persistent storage that will be requested when deployed. Can be omitted. Supported only
                            by a small subset of Kubernetes storage providers.
                          type: string
                        memory:
                          description: >
                            The amount of memory that will be requested when deployed. A pod will only be deployed to a node
                            that has this amount of memory available. You can  express memory as a plain integer using one of
                            these suffixes: T, G, M, K. You can also use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                          type: string
                        cpu:
                          description: >
                            The amount of CPU units that will be requested from a node at deployment time. A pod will only be
                            deployed to a node if the node has this amount of CPU units available. Supports decimal numbers, or
                            alternatively the suffix 'm' can be used to specify a millicore. Precision lower than 1m is not supported.
                          type: string
                    limits:
                      type: object
                      properties:
                        storage:
                          description: >
                            The maximum amount of persistent storage required by the
                            database server.  Limits and requests for memory are
                            measured in bytes. You can express storage as a plain
                            integer using one of these suffixes: T, G, M, K. You can
                            also use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                          type: string
                        memory:
                          description: >
                            The maximum amount of memory that the container is expected to use. Kubernetes will limit the amount
                            of memory to the container the to amount specified. You can  express memory as a plain integer using one of
                            these suffixes: T, G, M, K. You can also use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                          type: string
                        cpu:
                          description: >
                            The maximum amount of CPU units that will be required by the container. Supports decimal numbers, or
                            alternatively the suffix 'm' can be used to specify a millicore. Precision lower than 1m is not supported.
                          type: string
                    storageRequest:
                      description: >
                        Size of persistent storage that will be requested when
                        deployed. Can be omitted. Supported only by a small
                        subset of Kubernetes storage providers.
                      type: string
                    storageLimit:
                      description: >
                        The maximum amount of persistent storage require by the
                        Keycloak server. Only relevant if the 'embedded' DBMS
                        option is used. Limits and requests for memory are
                        measured in bytes. You can express storage as a plain
                        integer using one of these suffixes: T, G, M, K. You can
                        also use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                      type: string
                    memoryRequest:
                      description: >
                        The amount of memory that will be requested when
                        deployed. A pod will only be deployed to a node that has
                        this amount of memory available. You can  express memory
                        as a plain integer using one of these suffixes: T, G, M,
                        K. You can also use the power-of-two equivalents: Ti,
                        Gi, Mi, Ki.
                      type: string
                    memoryLimit:
                      description: >
                        The maximum amount of memory that the container is
                        expected to use. Kubernetes will limit the amount of
                        memory to the container the to amount specified. You
                        can  express memory as a plain integer using one of
                        these suffixes: T, G, M, K. You can also use the
                        power-of-two equivalents: Ti, Gi, Mi, Ki.
                      type: string
                    cpuRequest:
                      description: >
                        The amount of CPU units that will be requested from a
                        node at deployment time. A pod will only be deployed to
                        a node if the node has this amount of CPU units
                        available. Supports decimal numbers, or alternatively
                        the suffix 'm' can be used to specify a millicore.
                        Precision lower than 1m is not supported.
                      type: string
                    cpuLimit:
                      description: >
                        The maximum amount of CPU units that will be required by
                        the container.Supports decimal numbers, or alternatively
                        the suffix 'm' can be used to specify a millicore.
                        Precision lower than 1m is not supported.
                      type: string
                    fileUploadLimit:
                      description: >
                        The maximum file upload size. This limit will be
                        enforced by NGINX compliant Ingress controllers. The
                        suffix 'm' allows the limit to be specified in
                        megabytes, eg. '120m'.
                      type: string
                customImage:
                  description: >
                    The full URI of a custom image provided by the deployer.
                    This image needs to be based on the appropriate base image:
                    either entando/entando-keycloak or
                    entando/entando-redhat-sso
                  type: string
                frontEndUrl:
                  description: >
                    The URL that will be used to access Keycloak from web
                    applications. If the 'UseExternal' provisioning strategy
                    has been selected, this should be the base URL of the
                    external SSO service your would like to connect to.
                  type: string
                isDefault:
                  description: >
                    Set this property to 'true' if this Keycloak instance is to
                    be used by the deployments of other Entando custom resource
                    when they do not specify it themselves.
                  type: boolean
                standardImage:
                  description: >
                    One of the standard images for Keycloak provided by Entando.
                    The value can be either 'keycloak' or 'redhat-sso'. Please
                    note that, when the Entando Operator runs in certified Red
                    Hat mode, it will always use the 'redhat-sso' image. This
                    can be controlled by setting the environment variable
                    ENTANDO_K8S_OPERATOR_COMPLIANCE_MODE on the Entando Operator
                    to one of COMMUNITY or REDHAT
                  type: string
                  pattern: ^(keycloak|redhat-sso)$
                providedCapabilityScope:
                  description: >
                    The scope inside the Kubernetes cluster that this
                    EntandoKeycloakServer instance can be shared.
                    Available values are 'Namespace', 'Cluster' and 'Specified'.
                    Please refer to our documentation
                    pertaining to shared capabilities for more information.
                  type: string
                  pattern: ^(Dedicated|Specified|Namespace|Labeled|Cluster)$
                provisioningStrategy:
                  description: >
                    The strategy that will be used to make this EntandoKeycloakServer
                    available to its consumers. Values:

                    * UseExternal - use this EntandoKeycloakServer resource to point to an existing external Keycloak Service.

                    * DeployDirectly - deploy a new Keycloak server on demand
                  type: string
                  pattern: ^(UseExternal|DeployDirectly|DelegateToOperator)$
                adminSecretName:
                  description: >
                    The name of an Opaque secret that contains the 'username' and
                    'password' keys that gives the operator admin access to a
                    Keycloak server. This is used when the provisioning strategy
                    is 'UseExternal'.
                  type: string
                defaultRealm:
                  description: >
                    The default realm that clients using this EntandoKeycloakServer
                    instance will be created under. This can be used to isolate
                    the clients created by a specific deployment in their own
                    realm so as not to interfere with clients in other realms
                    that may have the same name. Please ensure that all
                    clients that have to communicate with each other share
                    the same realm.
                  type: string
            status:
              type: object
              properties:
                observedGeneration:
                  type: number
                phase:
                  type: string
                serverStatuses:
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
  names:
    kind: EntandoKeycloakServer
    plural: entandokeycloakservers
    shortNames:
      - ekcs
  scope: Namespaced

---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: entandoplugins.entando.org
  annotations:
    entando.org/controller-image: entando-k8s-plugin-controller
  labels:
    entando.org/crd-of-interest: EntandoPlugin
spec:
  group: entando.org
  versions:
    - name: v1
      served: true
      storage: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Phase
          type: string
          jsonPath: .status.phase
        - name: Observed Generation
          type: number
          jsonPath: .status.observedGeneration
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
        - name: Host
          type: string
          jsonPath: .spec.ingressHostName
        - name: Image
          type: string
          jsonPath: .spec.image
        - name: DBMS
          type: string
          jsonPath: .spec.dbms
        - name: Replicas
          type: integer
          jsonPath: .spec.replicas
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                image:
                  description: The Docker image URI where the container of this EntandoPlugin microservice can be found.
                  type: string
                replicas:
                  description: The number of pods that should participate in the cluster of Plugin microservices.
                  type: integer
                  minimum: 1
                  maximum: 10
                dbms:
                  description: >
                    The database management system (DBMS) to use for persistence of this EntandoPlugin microservice. Can be any of mysql, oracle
                    postgresql, embedded or none.
                    Only 1 replica of the container is supported if embedded is selected. If
                    Oracle is selected it must be created manually, the operator does not deploy Oracle instances.
                    See [here] (https://dev.entando.org/v6.3/docs/concepts/operator-intro.html#database-deployment) for how the operator will create and configure the DBMS.
                  type: string
                  pattern: '^(mysql|oracle|postgresql|embedded|none)$'
                storageClass:
                  description: >
                    The name of the StorageClass to use for PersistentVolumeClaims created for this EntandoPlugin
                  type: string
                ingressHostName:
                  description: >
                    The hostname that will be used to access this EntandoPlugin microservice from outside the cluster. The Entando
                    Operator will create an Ingress reflecting this hostname, and expose the microservice on the
                    path specified in 'EntandoPlugin.spec.ingressPath' on
                    this host. If omitted, the Entando Operator will automatically generate a hostname using the value of
                    the ENTANDO_DEFAULT_ROUTING_SUFFIX environment variable that the Entando Operator was configured with.
                    It will prefix the name and namespace of the EntandoPlugin to this default routing suffix.
                  type: string
                  pattern: '^([A-Za-z0-9-]{1,63}\.)*[[A-Za-z0-9-]{1,63}$'
                ingressPath:
                  description: >
                    The path that will be used to expose this EntandoPlugin microservice on the ingress host
                    specified in 'EntandoPlugin.spec.ingressHostname'. This property will also be used to specify
                    the SERVER_SERVLET_CONTEXT_PATH environment variable for the Spring Boot application inside this
                    container.
                  type: string
                tlsSecretName:
                  description: >
                    The name of a standard Kubernetes TLS Secret, assumed to be in the same Namespace as the EntandoPlugin
                    being created. See here: TODO for details and instructions on creating a TLS secret for your Entando applications.
                  type: string
                  pattern: '^([a-z])+([a-z0-9-\.])*[a-z0-9]$'
                serviceAccountToUse:
                  description: >
                    The Kubernetes ServiceAccount in the Namespace of the EntandoPlugin that is to be used for
                    the Pods hosting the EntandoPlugin microservices. The default is 'entando-plugin'.
                    This is mainly relevant when using the
                    entando-k8s-plugin-sidecar image as a companion container. This image needs access to the
                    underlying EntandoPlugin custom resource.
                  type: string
                  pattern: '^([a-z])+([a-z0-9-\.])*[a-z0-9]$'
                environmentVariables:
                  description: >
                    A list of environment variable following the standard structure of Kubernetes Environment Variables
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                      value:
                        type: string
                      valueFrom:
                        type: object
                        properties:
                          configMapKeyRef:
                            type: object
                            properties:
                              name:
                                description: Name of a ConfigMap in the same namespace as the EntandoPlugin
                                type: string
                              key:
                                description: Key of the ConfigMap entry in that holds the value to be used for the EnvironmentVariable
                                type: string
                          fieldRef:
                            type: object
                            properties:
                              apiVersion:
                                description: Version of the API to used for the field expression
                                type: string
                              fieldPath:
                                description: Full expression starting from the Pod resource
                                type: string
                          resourceFieldRef:
                            type: object
                            properties:
                              containerName:
                                description: Name of the container to use
                                type: string
                              resource:
                                description: Name of the resource to use
                                type: string
                          secretKeyRef:
                            type: object
                            properties:
                              name:
                                description: Name of a Secret in the same namespace as the EntandoPlugin
                                type: string
                              key:
                                description: Key of the Secret entry in that holds the value to be used for the EnvironmentVariable
                                type: string
                resourceRequirements:
                  description: >
                    The projected resource requirements of the given EntandoPlugin microservice deployment. Specifies the limits that the
                    container is expected to respect, and the size of requests that will be initiated on behalf of the
                    container. When omitted our known defaults will be applied.
                  type: object
                  properties:
                    requests:
                      type: object
                      properties:
                        storage:
                          description: >
                            Size of persistent storage that will be requested when deployed. Can be omitted. Supported only
                            by a small subset of Kubernetes storage providers.
                          type: string
                        memory:
                          description: >
                            The amount of memory that will be requested when deployed. A pod will only be deployed to a node
                            that has this amount of memory available. You can  express memory as a plain integer using one of
                            these suffixes: T, G, M, K. You can also use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                          type: string
                        cpu:
                          description: >
                            The amount of CPU units that will be requested from a node at deployment time. A pod will only be
                            deployed to a node if the node has this amount of CPU units available. Supports decimal numbers, or
                            alternatively the suffix 'm' can be used to specify a millicore. Precision lower than 1m is not supported.
                          type: string
                    limits:
                      type: object
                      properties:
                        storage:
                          description: >
                            The maximum amount of persistent storage required by the
                            database server.  Limits and requests for memory are
                            measured in bytes. You can express storage as a plain
                            integer using one of these suffixes: T, G, M, K. You can
                            also use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                          type: string
                        memory:
                          description: >
                            The maximum amount of memory that the container is expected to use. Kubernetes will limit the amount
                            of memory to the container the to amount specified. You can  express memory as a plain integer using one of
                            these suffixes: T, G, M, K. You can also use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                          type: string
                        cpu:
                          description: >
                            The maximum amount of CPU units that will be required by the container. Supports decimal numbers, or
                            alternatively the suffix 'm' can be used to specify a millicore. Precision lower than 1m is not supported.
                          type: string
                    storageRequest:
                      description: >
                        Size of persistent storage that will be requested when deployed. Can be omitted. Supported only
                        by a small subset of Kubernetes storage providers.
                      type: string
                    storageLimit:
                      description: >
                        The maximum amount of persistent storage require by the EntandoPlugin microservice. Mainly used
                        when the 'embedded' DBMS option is used. Limits and requests for memory are measured in bytes. You can
                        express storage as a plain integer using one of these suffixes: T, G, M, K. You can also
                        use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                      type: string
                    memoryRequest:
                      description: >
                        The amount of memory that will be requested when deployed. A pod will only be deployed to a node
                        that has this amount of memory available. You can  express memory as a plain integer using one of
                        these suffixes: T, G, M, K. You can also use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                      type: string
                    memoryLimit:
                      description: >
                        The maximum amount of memory that the container is expected to use. Kubernetes will limit the amount
                        of memory to the container the to amount specified. You can  express memory as a plain integer using one of
                        these suffixes: T, G, M, K. You can also use the power-of-two equivalents: Ti, Gi, Mi, Ki.
                      type: string
                    cpuRequest:
                      description: >
                        The amount of CPU units that will be requested from a node at deployment time. A pod will only be
                        deployed to a node if the node has this amount of CPU units available. Supports decimal numbers, or
                        alternatively the suffix 'm' can be used to specify a millicore. Precision lower than 1m is not supported.
                      type: string
                    cpuLimit:
                      description: >
                        The maximum amount of CPU units that will be required by the container.Supports decimal numbers, or
                        alternatively the suffix 'm' can be used to specify a millicore. Precision lower than 1m is not supported.
                      type: string
                    fileUploadLimit:
                      description: >
                        The maximum file upload size. This limit will be enforced by NGINX compliant Ingress controllers.
                        The suffix 'm' allows the limit to be specified in megabytes, eg. '120m'.
                      type: string
                keycloakToUse:
                  type: object
                  description: >
                    The properties of this object configure which Keycloak server this EntandoPlugin microservice will be using,
                    and allows the user to override the default Realm and PublicClientID to use.
                  properties:
                    realm:
                      description: >
                        The realm that will be used to create the OIDC Client for this EntandoPlugin microservice. If omitted, the
                        default realm will be 'Entando'. If another realm is specified, and it doesn't exist by
                        the time the EntandoPlugin microservice is deployed, the realm will be created on demand.
                      type: string
                    publicClientId:
                      description: >
                        The Client ID for the Public client that will be created this EntandoPlugin microservice.
                        Only required if this microservice should be accessible from outside the cluster. The
                        default is 'entando-web'.
                      type: string
                    name:
                      description: >
                        The name of the EntandoKeycloakServer to use as OIDC provider. If no name is provided, the
                        Entando Operator will then look for any EntandoKeycloakServer in the same Namespace as this
                        EntandoPlugin microservice and use it as OIDC provider. If no EntandoKeycloakServer is found,
                        it will then use the (last) EntandoKeycloakServer that was marked as the cluster wide  default
                        using the property EntandoKeycloakServer.spec.isDefault.
                      type: string
                    namespace:
                      description: >
                        The Namespace of the EntandoKeycloakServer to use as OIDC provider. This value is only
                        evaluated if the 'spec.keycloakToUse.name' property has been set on this
                        EntandoPlugin microservice.  If no Namespace is provided,
                        but a name was provided, the Entando Operator will then look for the
                        EntandoKeycloakServer with the name specified in the same Namespace as this
                        EntandoPlugin microservice and use it as OIDC provider.
                      type: string
                healthCheckPath:
                  description: >
                    A path that will be appended to the 'EntandoPlugin.spec.ingressPath' and used to determine whether
                    this EntandoPlugin microservice is ready to consume HTTP traffic. The service is considered ready
                    when it returns an HTTP code in the 200 range.
                  type: string
                securityLevel:
                  type: string
                  description: >
                    One of 'STRICT' or 'LENIENT'.

                    In 'STRICT' mode, the Entando Plugin Sidecar will not be deployed in
                    this EntandoPlugin microservice Pod. Secrets will be statically mounted in the EntandoPlugin microservice
                    container, and will be accessed as files.

                    In 'LENIENT' mode, the Entando Plugin Sidecar will be deployed, and it will be used to setup
                    Secrets that are used to connect to external services. This requires read/write access to Secrets
                    in the same namespace as the EntandPlugin microservice.
                connectionConfigNames:
                  type: array
                  items:
                    type: string
                  description: >
                    A list of the names of Secrets that are associated with this EntandoPlugin microservice. These
                    Secrets will be automatically mounted in the /etc/entando/connectionconfigs folder in the
                    EntandoPlugin microservice container.
                companionContainers:
                  type: array
                  items:
                    type: string
                  description: >
                    A list of known containers that can be deployed in the same Pod as this EntandoPlugin microservice.
                    Only the entando-plugin-sidecar container is currently supported.
                roles:
                  type: array
                  description: >
                    A list of roles required by this EntandoPlugin microservice. These roles will be created
                    automatically in Keycloak.
                  items:
                    type: object
                    properties:
                      code:
                        description: A short code used to identify this role.
                        type: string
                      name:
                        description: A human readible name used to identify this role.
                        type: string
                permissions:
                  type: array
                  description: >
                    A list of permissions that this EntandoPlugin microservice requires on existing Keycloak OIDC clients
                    in the cluster. This is only required if this EntandoPlugin microservice needs to talk to Keycloak
                    itself, or to other EntandoPlugin microservices in the cluster. For each permission configured, the
                    Entando Operator will assign the role specified to the Keycloak service account user associated
                    with the OIDC client that was created for this EntandoPlugin microservice.
                  items:
                    type: object
                    properties:
                      clientId:
                        description: >
                          The clientId of the other deployment (Keycloak, microservice) that this EntandoPlugin microservice
                          needs access too.
                        type: string
                      role:
                        description: >
                          The role required on the OIDC client of the service that this EntandoPlugin microservice
                          needs access too.
                        type: string
            status:
              type: object
              properties:
                observedGeneration:
                  type: number
                phase:
                  type: string
                entandoDeploymentPhase:
                  type: string
                serverStatuses:
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
  names:
    kind: EntandoPlugin
    plural: entandoplugins
    shortNames:
      - eps
  scope: Namespaced

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: ingress-viewer
rules:
  - apiGroups:
      - extensions
      - networking.k8s.io
    resources:
      - ingresses
    verbs:
      - list
      - get
      - watch

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: pod-viewer
rules:
  - apiGroups:
      - ''
    resources:
      - pods
    verbs:
      - list
      - get
      - watch
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: providedcapabilities.entando.org
  labels:
    entando.org/crd-of-interest: ProvidedCapability
spec:
  group: entando.org
  names:
    kind: ProvidedCapability
    plural: providedcapabilities
    shortNames:
      - pcs
  scope: Namespaced
  versions:
    - name: v1
      served: true
      storage: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Phase
          type: string
          jsonPath: .status.phase
        - name: Observed Generation
          type: number
          jsonPath: .status.observedGeneration
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                capability:
                  description: >
                    The type of capability to create, e.g. 'sso' or 'dbms'
                  type: string
                  pattern: ^(sso|dbms)$
                implementation:
                  description: >
                    The chosen implementation of the selected capability. The available values depend on the capability in question.
                    For instance, for 'sso' the valid values are 'keycloak' and 'redhat-sso'
                  type: string
                  pattern: ^(mysql|oracle|postgresql|redhat-sso|redhat_sso|keycloak)$
                resolutionScopePreference:
                  description: >
                    An ordered list expressing the preference that this capability will be available to. The first item
                    in the list will be added to the 'capabilityProvisionScope' label for optimized lookups by label.
                    Valid values are:
                     1. Dedicated: Capability requirements are matched using EntandoCustomResource.metadata.name + "-" + standardCapbility.suffix
                     2. Specified: Matched using requiredCapability.specifiedCapability
                     3. Namespace: Matched using the first capability found in the same namespace with a matching implementation and scope
                     4. Labeled: Matched using the first capability found in the cluster with the matching labels and a matching implementation
                     5. Cluster: Matched using the first capability found in the cluster with a matching implementation and operatorId
                     Each of these values would require a certain selection of fields that will be clarified further.
                  type: array
                  items:
                    type: string
                    pattern: ^(Dedicated|Specified|Namespace|Labeled|Cluster)$
                provisioningStrategy:
                  description: >
                    The mechanism used to provision the capability if required at al
                    Valid values are:
                    1. UseExternal: Provide the host, port and credentials in the ProvidedCapability.spec.externallyProvideService to connect an existing external service
                    2. DeployDirectly: Attempt to deploy this capability directly with known controllers
                    3. DelegateToOperator: Delegate the provisioning of this capability to the vendor's own Kubernetes Operator
                  type: string
                  pattern: ^(UseExternal|DeployDirectly|DelegateToOperator)$
                selector:
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
                  description: >
                    The names and values of labels to match when resolving ProvidedCapabilities. This is used when the 'ProvidedCapability.spec.scope' is 'Labeled'
                capabilityParameters:
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
                  description: >
                    Additional name/value pairs that are passed to the controller providing the capability in question
                specifiedCapability:
                  type: object
                  description: >
                    The properties of this object configure exactly which ProvidedCapability will be used, specified by name and namespace.
                    Provide the details of the ProvidedCapability to use or create when the 'ProvidedCapability.spec.scope' is 'Specified'.
                  properties:
                    name:
                      description: >
                        The name of the ProvidedCapability to use. This field is required.
                      type: string
                    namespace:
                      description: >
                        The Namespace of the ProvidedCapability to use. If no namespace is provided,
                        but a name was provided, the Entando Operator will then look for the
                        ProvidedCapability with the name specified in the same Namespace as the requesting EntandoCustomResource
                        and use it.
                      type: string
                externallyProvidedService:
                  type: object
                  description: >
                    The properties of this object configure allow the Entando Operator to deploy the correct networking
                    indirection: either an ExternalName service for a domain name, EndPoints based routing for an IP address.
                    Provide the details of the ProvidedCapability to use or create when the 'ProvidedCapability.spec.provisioningStrategy' is 'UseExternal'.
                  properties:
                    host:
                      description: >
                        The host the externally provided capability can be reached on. When it is standard DNS name, an ExternalName service will be created.
                        If t is an IP address, Endpoints will be used to route it to the external service.
                      type: string
                    port:
                      description: >
                        The port that the externally provided capability is hosted on
                      type: integer
                    adminSecretName:
                      description: >
                        The name of the Kubernetes Secret, assumed to be in the same namespace as the ProvidedCapability, that
                        can be used to connect to the service in question. This secret needs to declare exactly two fields:
                        'username' and 'password'. Generally this user will have the necessary credentials on the service
                        in question to provision resources as and when required.
                      type: string
                    path:
                      description: >
                        An optional path that will be suffixed to the host/port base when building a URI.
                      type: string
            status:
              type: object
              properties:
                observedGeneration:
                  type: number
                phase:
                  type: string
                serverStatuses:
                  type: object
                  x-kubernetes-preserve-unknown-fields: true


---
